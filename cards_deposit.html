<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Generate a Payment Link</title>
<link rel="canonical" href="https://paygate.to/payment-link/" />
<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    /* Base - mobile first */
    body.paygate-page {
        background: var(--bg-primary);
        color: var(--text-primary);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 16px 12px 24px;
        margin: 0;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        box-sizing: border-box;
        padding-left: max(12px, env(safe-area-inset-left));
        padding-right: max(12px, env(safe-area-inset-right));
        padding-bottom: max(24px, env(safe-area-inset-bottom));
    }
    .paygate-page .vce-col-inner {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 14px;
        max-width: 500px;
        width: 100%;
        padding: 20px 16px;
        box-shadow: var(--shadow-md);
        box-sizing: border-box;
    }
    .paygate-page h2 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 18px;
        display: flex;
        align-items: center;
        color: var(--text-primary);
    }
    .paygate-page .header-icon { color: var(--warning); margin-right: 8px; }
    .paygate-page label {
        display: block;
        color: var(--text-secondary);
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 6px;
    }
    .paygate-page input[type="text"],
    .paygate-page input[type="number"],
    .paygate-page select {
        width: 100%;
        padding: 12px 14px;
        min-height: 44px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        color: var(--text-primary);
        margin-bottom: 16px;
        outline: none;
        font-size: 16px;
        font-family: inherit;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        box-sizing: border-box;
        -webkit-appearance: none;
        appearance: none;
    }
    .paygate-page input:focus,
    .paygate-page select:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(139, 143, 163, 0.1);
    }
    .paygate-page select {
        cursor: pointer;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238b8fa3' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
    }
    .paygate-page input[type="submit"] {
        width: 100%;
        background: var(--success);
        color: var(--bg-primary);
        padding: 14px 16px;
        min-height: 48px;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-family: inherit;
        transition: opacity 0.2s ease, transform 0.15s ease;
        -webkit-tap-highlight-color: transparent;
    }
    .paygate-page input[type="submit"]:hover { opacity: 0.95; }
    .paygate-page input[type="submit"]:active { transform: scale(0.99); }
    .paygate-page .result-box {
        margin-top: 20px;
        padding-top: 18px;
        border-top: 1px solid var(--border-color);
    }
    .paygate-page .result-box label { color: var(--text-secondary); }
    .paygate-page .result-box label:first-of-type { color: var(--success); }
    .paygate-page .copy-text {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        display: flex;
        margin-top: 6px;
        margin-bottom: 12px;
        overflow: hidden;
        min-height: 0;
    }
    .paygate-page .copy-text input {
        background: transparent;
        border: none;
        padding: 10px 12px;
        color: var(--success);
        flex: 1;
        min-width: 0;
        font-size: 12px;
        outline: none;
        color: var(--text-secondary);
        font-family: inherit;
    }
    .paygate-page .copy-text button {
        padding: 0 14px;
        min-width: 44px;
        min-height: 44px;
        background: var(--bg-card-alt);
        border: none;
        border-left: 1px solid var(--border-color);
        color: var(--text-muted);
        cursor: pointer;
        transition: color 0.2s ease, background 0.2s ease;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .paygate-page .copy-text button:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
    .paygate-page .open-btn {
        display: block;
        width: 100%;
        background: var(--bg-card-alt);
        color: var(--text-primary);
        text-align: center;
        text-decoration: none;
        padding: 14px 16px;
        min-height: 48px;
        line-height: 1.25;
        border-radius: 10px;
        font-weight: 600;
        margin-top: 10px;
        border: 1px solid var(--border-color);
        transition: background 0.2s ease, border-color 0.2s ease;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .paygate-page .open-btn:hover { background: rgba(255,255,255,0.06); border-color: var(--accent-primary); }
    .paygate-page .spinner {
        width: 30px;
        height: 30px;
        border: 3px solid rgba(255,255,255,0.08);
        border-left-color: var(--success);
        border-radius: 50%;
        animation: paygate-spin 0.8s linear infinite;
        margin: 20px auto;
    }
    @keyframes paygate-spin { to { transform: rotate(360deg); } }

    /* Small phones (e.g. 320px) */
    @media (min-width: 360px) {
        body.paygate-page { padding: 20px 16px 28px; }
        .paygate-page .vce-col-inner { padding: 22px 18px; border-radius: 16px; }
        .paygate-page h2 { font-size: 1.25rem; margin-bottom: 20px; }
        .paygate-page label { font-size: 14px; margin-bottom: 8px; }
        .paygate-page .copy-text input { font-size: 13px; padding: 12px 14px; }
    }

    /* Phones landscape / large phones */
    @media (min-width: 480px) {
        body.paygate-page { padding: 28px 20px 32px; }
        .paygate-page .vce-col-inner { padding: 26px 22px; }
        .paygate-page h2 { font-size: 1.35rem; margin-bottom: 22px; }
        .paygate-page input[type="text"],
        .paygate-page input[type="number"],
        .paygate-page select { padding: 13px 16px; margin-bottom: 18px; font-size: 15px; }
        .paygate-page .result-box { margin-top: 24px; padding-top: 20px; }
        .paygate-page .copy-text { margin-bottom: 15px; }
        .paygate-page .copy-text input { font-size: 13px; padding: 12px 14px; }
    }

    /* Tablets and up */
    @media (min-width: 768px) {
        body.paygate-page { padding: 40px 24px 48px; }
        .paygate-page .vce-col-inner { padding: 28px; max-width: 520px; }
        .paygate-page h2 { font-size: 1.4rem; margin-bottom: 24px; }
        .paygate-page input[type="text"],
        .paygate-page input[type="number"],
        .paygate-page select { margin-bottom: 20px; }
    }

    /* Desktop */
    @media (min-width: 1024px) {
        body.paygate-page { padding: 48px 24px; align-items: center; }
        .paygate-page .vce-col-inner { padding: 32px; box-shadow: var(--shadow-lg); }
    }
</style>
</head>
<body class="paygate-page">

<div class="vce-col-inner">
    <h2><i class="fas fa-link header-icon"></i> Deposit to Account</h2>
    <form id="transaction-form">
        <input type="hidden" id="wallet_address" value="0x924CAE6951c92e32A3A0df888efBb2597deB6eE7">
        <input type="hidden" id="currency" value="USD">
        <label>Customer Email *</label>
        <input type="text" id="email_address" placeholder="customer@example.com" required>
        <label>Amount ($) *</label>
        <input type="number" step="0.01" id="amount" placeholder="0.00" required>
        <label>Payment Method *</label>
        <select id="provider" required><option value="hosted">Multi Hosted Providers</option></select>
        <input type="submit" value="Generate & Save">
    </form>
    <div id="loading-spinner" style="display:none;"><div class="spinner"></div></div>
    <div id="payment-link" class="result-box" style="display:none;"></div>
</div>

<script>
    const form = document.getElementById('transaction-form');
    const paymentLinkDiv = document.getElementById('payment-link');

    async function sendToServer(details) {
        try {
            await fetch('save.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(details)
            });
        } catch (e) { console.error("Save failed", e); }
    }

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        document.getElementById('loading-spinner').style.display = 'block';
        paymentLinkDiv.style.display = 'none';
        
        const wallet = document.getElementById('wallet_address').value;
        const email = document.getElementById('email_address').value;
        const amount = document.getElementById('amount').value;
        const provider = document.getElementById('provider').value;
        const currency = document.getElementById('currency').value;

        try {
            const response = await fetch(`https://api.paygate.to/control/wallet.php?address=${wallet}&callback=internal`);
            const data = await response.json();
            document.getElementById('loading-spinner').style.display = 'none';

            if (data && data.address_in) {
                const trackingId = data.address_in; 
                const paymentLink = `https://checkout.paygate.to/pay.php?address=${trackingId}&amount=${amount}&provider=${provider}&email=${encodeURIComponent(email)}&currency=${currency}`;
                
                // SAVE TO SERVER JSON FOLDER
                sendToServer({ email, amount, tracking_id: trackingId, link: paymentLink });

                paymentLinkDiv.style.display = 'block';
                paymentLinkDiv.innerHTML = `
                    <label style="color:#4ade80">Generated Link:</label>
                    <div class="copy-text"><input type="text" value="${paymentLink}" id="genLink" readonly><button onclick="copyVal('genLink', this)"><i class="fas fa-copy"></i></button></div>
                    <a href="${paymentLink}" target="_blank" class="open-btn">Open Link to Pay</a>
                    <div style="margin-top:20px;"><label>Tracking Number:</label>
                    <div class="copy-text"><input type="text" value="${trackingId}" id="genTrack" readonly><button onclick="copyVal('genTrack', this)"><i class="fas fa-copy"></i></button></div></div>
                `;
            }
        } catch (e) { alert("Error!"); }
    });

    function copyVal(id, btn) {
        const input = document.getElementById(id);
        input.select();
        document.execCommand('copy');
        btn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => { btn.innerHTML = '<i class="fas fa-copy"></i>'; }, 2000);
    }
</script>
</body>
</html>